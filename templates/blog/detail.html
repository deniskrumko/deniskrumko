{% extends "base.html" %}
{% load static i18n %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static 'css/blog/detail.css' %}">
<link rel="stylesheet" href="{% static 'css/plyr/plyr.min.css' %}">
{% endblock %}

{% block extrajs %}
<script src="{% static 'js/plyr/plyr.js' %}" charset="utf-8"></script>
<script>
  {% if item.video.source == 'youtube' %}
  const player = new Plyr('#player', {});
  window.player = player;
  {% else %}
  const player = new Plyr('#player');
  {% endif %}
</script>
{% endblock %}

{% block body %}

{# Menu #}
{% include 'components/menu.html' %}

<div class="uk-container uk-container-small">

{% if not item.is_active %}
  <h1 class="dk-blog-detail-title dk-opensans dk-bold">{{ item.title }}</h1>
  <p>На данный момент этот блог недоступен.</p>
  <p>Скоро все починим!</p>
{% else %}

  {% if item.video %}
    {% if item.video.source == 'youtube' %}
      <div id="player" data-plyr-provider="youtube" data-plyr-embed-id="{{ item.video.youtube_link }}"></div>
    {% endif %}

    {% if item.video.source == 'src' %}
      <video id="player" {% if item.video.poster %}poster="{{ item.video.poster.url }}"{% endif %} controls>
        {# HD - 720p #}
        {% if item.video.source_720 %}
          <source src="{{ item.video.source_720 }}" type="video/mp4" size="720">
        {% endif %}

        {# Full HD - 1080p #}
        {% if item.video.source_1080 %}
          <source src="{{ item.video.source_1080 }}" type="video/mp4" size="1080">
        {% endif %}

        {# Low - 480p #}
        {% if item.video.source_480 %}
          <source src="{{ item.video.source_480 }}" type="video/mp4" size="480">
        {% endif %}

        {# Very low - 360p #}
        {% if item.video.source_360 %}
          <source src="{{ item.video.source_360 }}" type="video/mp4" size="360">
        {% endif %}
      </video>
    {% endif %}

  {% endif %}

  {# Title #}
  <h1 class="dk-blog-detail-title dk-opensans dk-bold">{{ item.title }}</h1>

  {# Subtitle #}
  {% if item.subtitle %}
  <p class="dk-blog-detail-subtitle">{{ item.subtitle }}</p>
  {% endif %}

  <div class="uk-hidden@s">
    <br>

    {% if item.next_part %}
    <a href="{% url 'blog:detail' item.next_part.slug %}" class="uk-button uk-button-primary uk-width-1-1">
      Следующая часть
    </a>
    {% endif %}

    {% if item.prev_part %}
    <a href="{% url 'blog:detail' item.prev_part.slug %}" class="uk-button uk-button-default uk-width-1-1  uk-margin-small-top">
      Предыдущая часть
    </a>
    {% endif %}

    <a class="uk-button uk-button-default uk-width-1-1 uk-margin-small-top" href="{% url 'blog:index' %}">
      Назад
    </a>
  </div>

  <div class="uk-visible@s">
    <br>

    {% if item.next_part %}
    <a href="{% url 'blog:detail' item.next_part.slug %}" class="uk-button uk-button-primary uk-margin-right">
      Следующая часть
    </a>
    {% endif %}

    {% if item.prev_part %}
    <a href="{% url 'blog:detail' item.prev_part.slug %}" class="uk-button uk-button-text uk-margin-right">
      Предыдущая часть
    </a>
    {% endif %}

    {% if item.video %}
    <a href="{% url 'blog:download' item.slug %}" class="uk-button uk-button-text">
      Скачать
    </a>
    {% endif %}
  </div>

  {# Description #}
  {% if item.text %}
  <br>
  <hr>
  <h2 class="dk-blog-h2 dk-opensans dk-center">Описание</h2>
    {% autoescape off %}
      {{ item.text }}
    {% endautoescape %}
  <br>
  {% endif %}

  {# Gallery #}
  {% if item.show_gallery %}
  <br>
  <hr>
  <h2 class="dk-blog-h2 dk-opensans dk-center">Галерея</h2>
  <br>
  <div class="uk-child-width-1-3 uk-child-width-1-4@m uk-child-width-1-6@l" uk-grid uk-lightbox="animation: slide">
    {% for image in item.images.all %}
    <div>
        <a class="uk-inline" style="transform: rotate({{ degrees|random }}deg);" href="{{ image.image.url }}" {% if image.description %}data-caption="{{ image.description }}"{% endif %}>
            <img src="{{ image.image_thumbnail.url }}" class="dk-gallery-image" alt="">
        </a>
    </div>
    {% endfor %}
  </div>
  <br>
  {% endif %}

  {# Blog relations #}
  {% if item.relations.exists %}
  <br>
  <hr>
  <h2 class="dk-blog-h2 dk-opensans dk-center">Также посмотрите</h2>
  <div class="uk-child-width-1-3@m uk-child-width-1-3@s" uk-grid>
    {% for blog in item.relations.all %}
    <div class="">
      <div class="uk-padding uk-background-muted">
        <h3 style="margin-bottom: 0px;" class="dk-related-h3">{{ blog.related_blog.title }}</h3>
        {% if blog.related_blog.subtitle %}
          <p style="margin-top: 0px;" class="uk-visible@s">{{ blog.related_blog.subtitle }}</p>
        {% endif %}
        <a href="{% url 'blog:detail' blog.related_blog.slug %}" class="uk-button uk-button-text">Посмотреть</a>
      </div>
    </div>
    {% endfor %}
  </div>

  {% endif %}

  <p class="dk-date">
    Опубликовано: {{ item.date }}
    {% if request.user.is_superuser %}
      •  
    <a href="{{ item.admin_changelink }}">Изменить</a>
    {% endif %}
  </p>

  {% endif %}

</div>
<br>
{% endblock %}
